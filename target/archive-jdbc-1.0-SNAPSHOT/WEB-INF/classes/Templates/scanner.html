<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Scanner / Importer un document</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { text-align: center; }
    hr { margin: 15px 0; border: none; height: 2px; background-color: #ccc; }
    .container { display: flex; gap: 20px; }
    .sidebar { width: 20%; background-color: #f4f4f4; border-radius: 8px; padding: 15px; }
    .main { flex: 1; display: flex; flex-direction: column; gap: 20px; }
    .card { background: white; border-radius: 10px; padding: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
    #preview img, #preview iframe { border: 1px solid #ccc; padding: 5px; max-width: 100%; border-radius: 5px; }
    button, input[type=file] { margin-top: 15px; padding: 10px 15px; border: none; background-color: #004080; color: white; border-radius: 6px; cursor: pointer; }
    button:hover { background-color: #002c5c; }
    video, canvas { margin-top: 20px; max-width: 100%; border-radius: 8px; }
    .redirect-text { text-align: center; font-style: italic; margin-top: 10px; }
    .redirect-text a { color: #004080; text-decoration: none; }
    .redirect-text a:hover { text-decoration: underline; }
  </style>
</head>
<body>

<h1>Scan ou Import de Document</h1>
<hr>

<div class="container">
  <!-- Barre latÃ©rale -->
  <div class="sidebar">
    <h3>Menu</h3>
    <ul>
      <li>Accueil</li>
      <li>Mes documents</li>
      <li>ParamÃ¨tres</li>
    </ul>
  </div>

  <!-- Zone principale -->
  <div class="main">
    <!-- Importation -->
    <div class="card">
      <h3>ðŸ“‚ Importer un document</h3>
      <input type="file" id="fileInput" accept="image/*,application/pdf">
      <div id="preview"></div>
    </div>

    <!-- Scanner -->
    <div class="card">
      <h3>ðŸ“· Scanner avec la camÃ©ra</h3>
      <button onclick="startCamera()">Activer la camÃ©ra</button>
      <video id="camera" autoplay></video>
      <button id="captureBtn" style="display:none;">ðŸ“¸ Capturer et envoyer</button>
    </div>

    <!-- Redirection vers formulaire -->
    <p class="redirect-text">
      PrÃªt Ã  envoyer votre document ? <a href="#" id="goForm">Aller au formulaire</a>
    </p>
  </div>
</div>

<script>
  let fileData = null;
  let fileType = null;

  // Importation fichier
  document.getElementById('fileInput').addEventListener('change', function(event) {
    const file = event.target.files[0];
    const preview = document.getElementById('preview');
    preview.innerHTML = '';

    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        fileData = e.target.result;
        fileType = file.type;
        localStorage.setItem("uploadedFile", fileData);
        localStorage.setItem("fileType", fileType);
      };
      reader.readAsDataURL(file);

      if (file.type.startsWith('image/')) {
        const img = document.createElement('img');
        img.src = URL.createObjectURL(file);
        preview.appendChild(img);
      } else if (file.type === 'application/pdf') {
        const iframe = document.createElement('iframe');
        iframe.src = URL.createObjectURL(file);
        iframe.width = "400";
        iframe.height = "500";
        preview.appendChild(iframe);
      }
    }
  });

 // Bouton aller au formulaire
document.getElementById("goForm").addEventListener("click", function(e) {
    e.preventDefault();
    window.location.href = "/archive-jdbc-1.0-SNAPSHOT/formulaire";
});


  // Activer la camÃ©ra
  function startCamera() {
    navigator.mediaDevices.getUserMedia({ video: true })
      .then(stream => {
        document.getElementById('camera').srcObject = stream;
        document.getElementById('captureBtn').style.display = "inline-block";
      })
      .catch(error => {
        alert("Impossible d'accÃ©der Ã  la camÃ©ra : " + error);
      });
  }

  // Capturer image et envoyer vers formulaire
  document.getElementById('captureBtn').addEventListener('click', function() {
    const video = document.getElementById('camera');
    const canvas = document.createElement('canvas');
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    canvas.getContext('2d').drawImage(video, 0, 0);

    const imageData = canvas.toDataURL('image/png');
    localStorage.setItem("uploadedFile", imageData);
    localStorage.setItem("fileType", "image/png");

    window.location.href = "formulaire.html";
  });
</script>
   
    <a href="${pageContext.request.contextPath}/formulaire" id="goFormLink">Aller au formulaire</a>
</body>
</html>
